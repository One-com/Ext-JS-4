<!DOCTYPE html><html><head><title>Sencha Documentation Project</title><link rel="stylesheet" href="../reset.css" type="text/css"><link rel="stylesheet" href="../prettify.css" type="text/css"><link rel="stylesheet" href="../prettify_sa.css" type="text/css"><script type="text/javascript" src="../prettify.js"></script></head><body onload="prettyPrint()"><pre class="prettyprint"><pre><a name="cls-Ext.form.File"></a>/**
 * @class Ext.form.File
 * @extends Ext.form.Text

A file upload field which has custom styling and allows control over the button text and other
features of {@link Ext.form.Text text fields} like {@link Ext.form.Text#emptyText empty text}.
It uses a hidden file input element behind the scenes to allow user selection of a file and to
perform the actual upload during {@link Ext.form.Basic#submit form submit}.

Because there is no secure cross-browser way to programmatically set the value of a file input,
the standard Field `setValue` method is not implemented. The `{@link #getValue}` method will return
a value that is browser-dependent; some have just the file name, some have a full path, some use
a fake path.

#Example Usage:#

    Ext.create(&#39;Ext.form.FormPanel&#39;, {
        renderTo: Ext.getBody(),
        width: 500,
        frame: true,
        title: &#39;Upload a Photo&#39;,
        bodyPadding: 10,

        items: [{
            xtype: &#39;filefield&#39;,
            name: &#39;photo&#39;,
            fieldLabel: &#39;Photo&#39;,
            labelWidth: 50,
            msgTarget: &#39;side&#39;,
            allowBlank: false,
            anchor: &#39;100%&#39;,
            buttonText: &#39;Select Photo...&#39;
        }],

        buttons: [{
            text: &#39;Upload&#39;,
            handler: function() {
                var form = this.up(&#39;form&#39;).getForm();
                if(form.isValid()){
                    form.submit({
                        url: &#39;photo-upload.php&#39;,
                        waitMsg: &#39;Uploading your photo...&#39;,
                        success: function(fp, o) {
                            Ext.Msg.alert(&#39;Success&#39;, &#39;Your photo &quot;&#39; + o.result.file + &#39;&quot; has been uploaded.&#39;);
                        }
                    });
                }
            }
        }]
    });

 * @constructor
 * Create a new File field
 * @param {Object} config Configuration options
 * @xtype filefield
 * @markdown
 * @docauthor Jason Johnston &lt;jason@sencha.com&gt;
 */
Ext.define(&quot;Ext.form.File&quot;, {
    extend: &#39;Ext.form.Text&#39;,
    alias: [&#39;widget.filefield&#39;, &#39;widget.fileuploadfield&#39;],
    alternateClassName: [&#39;Ext.form.FileUploadField&#39;, &#39;Ext.ux.form.FileUploadField&#39;],
    uses: [&#39;Ext.button.Button&#39;, &#39;Ext.layout.component.form.File&#39;],

    <a name="cfg-Ext.form.File-buttonText"></a>/**
     * @cfg {String} buttonText The button text to display on the upload button (defaults to
     * &#39;Browse...&#39;).  Note that if you supply a value for {@link #buttonCfg}, the buttonCfg.text
     * value will be used instead if available.
     */
    buttonText: &#39;Browse...&#39;,

    <a name="cfg-Ext.form.File-buttonOnly"></a>/**
     * @cfg {Boolean} buttonOnly True to display the file upload field as a button with no visible
     * text field (defaults to false).  If true, all inherited Text members will still be available.
     */
    buttonOnly: false,

    <a name="cfg-Ext.form.File-buttonMargin"></a>/**
     * @cfg {Number} buttonMargin The number of pixels of space reserved between the button and the text field
     * (defaults to 3).  Note that this only applies if {@link #buttonOnly} = false.
     */
    buttonMargin: 3,

    <a name="cfg-Ext.form.File-buttonCfg"></a>/**
     * @cfg {Object} buttonCfg A standard {@link Ext.button.Button} config object.
     */

    <a name="event-Ext.form.File-change"></a>/**
     * @event change
     * Fires when the underlying file input field&#39;s value has changed from the user
     * selecting a new file from the system file selection dialog.
     * @param {Ext.ux.form.FileUploadField} this
     * @param {String} value The file value returned by the underlying file input field
     */

    <a name="prop-Ext.form.File-fileInputEl"></a>/**
     * @property fileInputEl
     * @type {Ext.core.Element}
     * A reference to the invisible file input element created for this upload field. Only
     * populated after this component is rendered.
     */

    <a name="prop-Ext.form.File-button"></a>/**
     * @property button
     * @type {Ext.button.Button}
     * A reference to the trigger Button component created for this upload field. Only
     * populated after this component is rendered.
     */

    <a name="cfg-Ext.form.File-fieldBodyCls"></a>/**
     * @cfg {String} fieldBodyCls
     * An extra CSS class to be applied to the body content element in addition to {@link #fieldBodyCls}.
     * Defaults to &#39;x-form-file-wrap&#39; for file upload field.
     */
    fieldBodyCls: Ext.baseCSSPrefix + &#39;form-file-wrap&#39;,


    // private
    readOnly: true,
    componentLayout: &#39;filefield&#39;,

    // private
    onRender: function() {
        var me = this,
            inputEl;

        me.callParent(arguments);

        me.createButton();
        me.createFileInput();

        inputEl = me.inputEl;
        inputEl.dom.removeAttribute(&#39;name&#39;); //name goes on the fileInput, not the text input
        if (me.buttonOnly) {
            inputEl.setDisplayed(false);
        }
    },

    /**
     * @private
     * Creates the custom trigger Button component. The fileInput will be inserted into this.
     */
    createButton: function() {
        var me = this;
        me.button = Ext.widget(&#39;button&#39;, Ext.apply({
            renderTo: me.bodyEl,
            text: me.buttonText,
            cls: Ext.baseCSSPrefix + &#39;form-file-btn&#39;,
            preventDefault: false,
            ownerCt: me,
            style: me.buttonOnly ? &#39;&#39; : &#39;margin-left:&#39; + me.buttonMargin + &#39;px&#39;
        }, me.buttonCfg));
    },

    /**
     * @private
     * Creates the file input element. It is inserted into the trigger button component, made
     * invisible, and floated on top of the button&#39;s other content so that it will receive the
     * button&#39;s clicks.
     */
    createFileInput : function() {
        var me = this;
        me.fileInputEl = me.button.el.createChild({
            name: me.getName(),
            cls: Ext.baseCSSPrefix + &#39;form-file-input&#39;,
            tag: &#39;input&#39;,
            type: &#39;file&#39;,
            size: 1
        }).on(&#39;change&#39;, me.onFileChange, me);
    },

    /**
     * @private Event handler fired when the user selects a file.
     */
    onFileChange: function() {
        var me = this;
        me.lastValue = null; // force change event to get fired even if the user selects a file with the same name
        Ext.form.File.superclass.setValue.call(me, me.fileInputEl.dom.value);
    },

    <a name="prop-Ext.form.File-setValue"></a>/**
     * Overridden to do nothing
     * @hide
     */
    setValue: Ext.emptyFn,

    reset : function(){
        this.fileInputEl.remove();
        this.createFileInput();
        this.callParent();
    },

    onDisable: function(){
        var me = this;
        me.callParent();
        me.fileInputEl.dom.disabled = true;
        me.button.disable();
    },

    onEnable: function(){
        var me = this;
        me.callParent();
        me.fileInputEl.dom.disabled = false;
        me.button.enable();
    },

    isFileUpload: function() {
        return true;
    },

    getFileInput: function() {
        return this.fileInputEl.dom;
    },

    onDestroy: function(){
        Ext.destroyMembers(this, &#39;fileInputEl&#39;, &#39;button&#39;);
        this.callParent();
    }


});
ï¿¿</pre></pre></body></html>